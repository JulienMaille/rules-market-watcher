<!DOCTYPE html>
<html>
<head>
<title>Description des packs</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="color-scheme" content="dark light">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<script src="js/listings.js?v=2"></script>
<script>
var nbUsers = 24419;
var closedPacks = {"Launch Pack S1":1317,"Honey Base Pack":69,"Halloween Pack":478,"Wave Base Pack":167,"Dark Base Pack":101,"Starter Pack S1":180,"Kush Base Pack":85};
var usersWithPack = {"Launch Pack S1":874,"Honey Base Pack":69,"Halloween Pack":354,"Wave Base Pack":117,"Dark Base Pack":78,"Starter Pack S1":180,"Kush Base Pack":85};

function showCards(cards, total) {
  let t = "<div class='cards'>";
  for( c of cards ) {
    if( c.quantity==null ) c.quantity = total/cards.length;
    let perc = (100*c.quantity/total);
    t += "<div class='card'><a href='https://rules.art/card/" + c.cardModel.slug + "'><img src='" + c.cardModel.pictureUrl + "'></a><br>"
       + c.quantity + "<br>"
       + "<span class='perc'>" + (perc).toFixed(perc>0.1 ? 1 : 2) + "%</span>"
       + "</div>";
  }
  return t + "</div>";
}

function showPack(p) {
  let total = ((p.maxSupply != null ) ? p.maxSupply : p.supply) * p.cardsPerPack;
  let closed = closedPacks[p.displayName]!==undefined ? closedPacks[p.displayName] : -1;
  let userClosed = usersWithPack[p.displayName]!==undefined ? usersWithPack[p.displayName] : -1;
  let url = "https://rules.art/pack/" + p.slug;
  let t = "<div class='pack'><div class='pic'><a href='" + url + "'><img width=48 src='" + p.pictureUrl + "' alt='" + p.displayName + "'></a></div>"
        + "<div class='desc'><a href='" + url + "'><b>" + p.displayName + "</b></a><br>"
        + (p.maxBuyableSupply != null ? p.maxBuyableSupply + " packs mis en vente, " : "")
        + p.availableQuantity + " par personne"
        + "<br>contient " + p.cardModelsCount + " cartes diff√©rentes<br>"
        + "distribu√© √† " + p.supply + " exemplaires"
        + (closed>0 ? " dont " + closed + " toujours scell√©s (" + (100*closed/p.supply).toFixed(1) + "%)" : "")
        + (userClosed>0 && userClosed!=closed ? " d√©tenus par " + userClosed + " personnes" : "")
        + "</div>"
        + showCards(p.cardModels, total);
  document.querySelector("#packs").innerHTML += t;
}

// main
async function main() {
  document.querySelector("#packs").innerHTML = "Loading...";
  let packs = (await fetchClassicPacks()).data.allClassicPacks.nodes;
  packs.push((await fetchLastStarterPack()).data.lastStarterPack);
  document.querySelector("#packs").innerHTML = "";
  for( p of packs ) showPack(p);
  document.querySelector("#update").innerHTML = "Statistics from üìà" + nbUsers + " Rules users.";
}

document.addEventListener("DOMContentLoaded", function() {
  main();
});

</script>
<style>
  body {font-family: Roboto,Helvetica;}
  @media (prefers-color-scheme: dark) { a {color: #CCC;} }
  @media (prefers-color-scheme: light) { a {color: #000;} }
  a {text-decoration: none;}
  a:hover {text-decoration: underline;}
  #date {font-stretch: condensed; color: #777;}
  #update, #missing {color: #777;}
  #menu, #options, #infos {float:left;}
  #menu, #infos {margin-top: -6px;}
  #menu a:hover {color: transparent; text-decoration: none; text-shadow: 0 0 0 #9f04dc;}
  #packs, .pack {clear: both; padding: 6px 0px;}
  .pic {float: left; margin-right: 6px;}
  .cards {clear: left;}
  .card {font-size: 12px; display: inline-block;}
  .card img {width: 48px;}
  .perc {color: #777;}
</style>
</head>
<body>
<div id="menu">
  <a href="index.html">üõí</a>
  <a href="transfers.html">üßæ</a>
  <a href="user.html">ü§ë</a>
  <a href="fee.html">üí∏</a>
  <a href="packs.html">üÉè</a>
</div>
<div id="infos">
  <span id="update"></span>
</div>
<div id="packs"></div>
</body>
</html>
